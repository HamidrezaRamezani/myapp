<!DOCTYPE html>
<html>
<head>
        <script src="static/jquery-2.1.1.min.js"></script>
        <link rel="stylesheet" href="static/css/bootstrap-3.2.0.min.css">
        <script src="static/js/bootstrap.min.js"></script>
        <meta name="viewport" content = "width=device-width, initial-scale=1.0">
<script>
// this is a simple function to unhide the "myDIV" class, I'm using this 
// function when the progress bar reached 100%.
// the "myDIV" class is a message shows after the progress bar reached 100%
function myFunction() {
    var x = document.getElementById("myDIV");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}
        var source = new EventSource("/progress");
        source.onmessage = function(event) {
                $('.progress-bar').css('width', event.data+'%').attr('aria-valuenow', event.data);
                $('.progress-bar-label').text(event.data+'%');
                if(event.data == 100){
                        source.close()
// i have set below sleep function to produce a delay before running "myFunction"
// because when the progress bar were 90% successfull messages shows.
// After this sleep function it look better.
                        function sleep (time) {
                            return new Promise((resolve) => setTimeout(resolve, time));
                          }
                       sleep(1500).then(() => {
                           myFunction() });
                }
        }
        </script>
</head>
<body>
      <div class="container">
        <h3 style="text-align: center;">We are generating the image, please be patient ...</h3>
         <div class="progress" style="width: 90%; margin: 50px;">
           <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
              <span class="progress-bar-label">0%</span>
           </div>
        </div>

        <div id="myDIV" style="display: none;text-align: center;">
          <h3> Notice: The image with serial <b>{{serial}}</b> successfully created  </h3>
          <h3><a href = "\list">Download the image</a></h3>
        </div>
      </div>
</body>
</html>
